var twig=function(a){var c=a.id;if(a.debug!==void 0)Twig.debug=a.debug;if(a.data!==void 0)return a=Twig.prepare(a.data),new Twig.Template(a,c);else if(a.ref!==void 0){if(a.id!==void 0)throw Error("Both ref and id cannot be set on a twig.js template.");return Twig.Templates.load(a.ref)}else if(a.href!==void 0)return Twig.Templates.loadRemote(a.href,c,a.load,a.async,a.precompiled)};
twig.compile=function(a,c){var b=c.filename,d=Twig.prepare(a),e=Twig.Templates.load(b);e===null&&(e=new Twig.Template(d,b));return function(a){return e.render(a)}};
var Twig=function(a){a.trace=false;a.debug=false;a.Error=function(a){this.message=a;this.name="Twig.Exception"};a.Error.prototype.toString=function(){return this.name+": "+this.message};a.log={trace:function(){a.trace&&console.log(Array.prototype.slice.call(arguments))},debug:function(){a.debug&&console.log(Array.prototype.slice.call(arguments))}};a.token={};a.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw"};a.token.definitions={output:{type:a.token.type.output,open:"{{",close:"}}"},
logic:{type:a.token.type.logic,open:"{%",close:"%}"},comment:{type:a.token.type.comment,open:"{#",close:"#}"}};a.token.strings=['"',"'"];a.token.findStart=function(c){var b={position:null,def:null},d,e,f;for(d in a.token.definitions)if(a.token.definitions.hasOwnProperty(d)&&(e=a.token.definitions[d],f=c.indexOf(e.open),a.log.trace("Twig.token.findStart: ","Searching for ",e.open," found at ",f),f>=0&&(b.position===null||f<b.position)))b.position=f,b.def=e;return b};a.token.findEnd=function(c,b,d){for(var e=
null,f=false,g=0,h=null,k=null,j=null,i=h=null,h=null,l,m;!f;){k=h=null;j=c.indexOf(b.close,g);if(j>=0)e=j,f=true;else throw new a.Error("Unable to find closing bracket '"+b.close+"' opened near template position "+d);m=a.token.strings.length;for(l=0;l<m;l+=1)if(i=c.indexOf(a.token.strings[l],g),i>0&&i<j&&(h===null||i<h))h=i,k=a.token.strings[l];if(h!==null){h+=1;e=null;for(f=false;;){h=c.indexOf(k,h);if(h<0)throw"Unclosed string in template";if(c.substr(h-1,1)!=="\\"){g=h+1;break}else h+=1}}}return e};
a.tokenize=function(c){for(var b=[],d=0,e=null,f=null;c.length>0;)e=a.token.findStart(c),a.log.trace("Twig.tokenize: ","Found token: ",e),e.position!==null?(e.position>0&&b.push({type:a.token.type.raw,value:c.substring(0,e.position)}),c=c.substr(e.position+e.def.open.length),d+=e.position+e.def.open.length,f=a.token.findEnd(c,e.def,d),a.log.trace("Twig.tokenize: ","Token ends at ",f),b.push({type:e.def.type,value:c.substring(0,f).trim()}),c=c.substr(f+e.def.close.length),d+=f+e.def.close.length):
(b.push({type:a.token.type.raw,value:c}),c="");return b};a.compile=function(c){for(var b=[],d=[],e=[],f=null,g=f=f=f=null,h=null,k=g=null,j=null,i=null;c.length>0;){f=c.shift();switch(f.type){case a.token.type.raw:d.length>0?e.push(f):b.push(f);break;case a.token.type.logic:f=a.logic.compile(f);k=f.type;j=a.logic.handler[k].open;i=a.logic.handler[k].next;a.log.trace("Twig.compile: ","Compiled logic token to ",f," next is: ",i," open is : ",j);if(j!==void 0&&!j){g=d.pop();h=a.logic.handler[g.type];
if(h.next.indexOf(k)<0)throw Error(k+" not expected after a "+g.type);g.output=g.output||[];g.output=g.output.concat(e);e=[];g={type:a.token.type.logic,token:g};d.length>0?e.push(g):b.push(g)}if(i!==void 0&&i.length>0){a.log.trace("Twig.compile: ","Pushing ",f," to logic stack.");if(d.length>0)g=d.pop(),g.output=g.output||[],g.output=g.output.concat(e),d.push(g);d.push(f)}else j!==void 0&&j&&(g={type:a.token.type.logic,token:f},d.length>0?e.push(g):b.push(g));break;case a.token.type.output:f=a.expression.compile(f),
d.length>0?e.push(f):b.push(f)}a.log.trace("Twig.compile: "," Output: ",b," Logic Stack: ",d," Pending Output: ",e)}if(d.length>0)throw f=d.pop(),Error("Unable to find an end tag for "+f.type+", expecting one of "+f.next.join(", "));return b};a.parse=function(c,b){var d=[],e=true,b=b||{};c.forEach(function(c){a.log.debug("Twig.parse: ","Parsing token: ",c);switch(c.type){case a.token.type.raw:d.push(c.value);break;case a.token.type.logic:c=a.logic.parse(c.token,b,e);if(c.chain!==void 0)e=c.chain;
if(c.context!==void 0)b=c.context;c.output!==void 0&&d.push(c.output);break;case a.token.type.output:d.push(a.expression.parse(c.stack,b))}});return d.join("")};a.prepare=function(c){a.log.debug("Twig.prepare: ","Tokenizing ",c);c=a.tokenize(c);a.log.debug("Twig.prepare: ","Compiling ",c);c=a.compile(c);a.log.debug("Twig.prepare: ","Compiled ",c);return c};a.Templates={registry:{}};a.Templates.save=function(c){if(c.id===void 0)throw new a.Error("Unable to save template with no id");a.Templates.registry[c.id]=
c};a.Templates.load=function(c){return!a.Templates.registry.hasOwnProperty(c)?null:a.Templates.registry[c]};a.Templates.loadRemote=function(c,b,d,e,f){b===void 0&&(b=c);if(a.Templates.registry.hasOwnProperty(b))return a.Templates.registry[b];if(typeof XMLHttpRequest=="undefined")throw Error("Unsupported platform: Unable to do remote requests because there is no XMLHTTPRequest implementation");var g=new XMLHttpRequest;g.onreadystatechange=function(){var c=null,c=null;g.readyState==4&&(a.log.debug("Got template ",
g.responseText),c=f===true?JSON.parse(g.responseText):a.prepare(g.responseText),c=new a.Template(c,b),d&&d(c))};g.open("GET",c,e===true);g.send()};a.Template=function(c,b){this.id=b;this.tokens=c;this.render=function(b){a.log.debug("Twig.Template: ","Rendering template with context: ",b);b=a.parse(c,b);a.log.debug("Twig.Template: ","Template rendered to: ",b);return b};b!==void 0&&a.Templates.save(this)};return a}(Twig||{});
(function(){if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===null)throw new TypeError;var c=Object(this),b=c.length>>>0;if(b===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=b)return-1;for(d=d>=0?d:Math.max(b-Math.abs(d),0);d<b;d++)if(d in c&&c[d]===a)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){var b,d;if(this==
null)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if({}.toString.call(a)!="[object Function]")throw new TypeError(a+" is not a function");c&&(b=c);for(d=0;d<f;){var g;d in e&&(g=e[d],a.call(b,g,d,e));d++}};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var c=[],b;for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}})();
Twig=function(a){a.logic={};a.logic.type={if_:"if",endif:"endif",for_:"for",endfor:"endfor",else_:"else",elseif:"elseif",set:"set"};a.logic.definitions=[{type:a.logic.type.if_,regex:/^if\s+([^\s].+)$/,next:[a.logic.type.else_,a.logic.type.elseif,a.logic.type.endif],open:true,compile:function(c){c.stack=a.expression.compile({type:a.expression.type.expression,value:c.match[1]}).stack;delete c.match;return c},parse:function(c,b,d){var e="",f=a.expression.parse(c.stack,b),d=true;f===true&&(d=false,e=
a.parse(c.output,b));return{chain:d,output:e}}},{type:a.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[a.logic.type.else_,a.logic.type.endif],open:false,compile:function(c){c.stack=a.expression.compile({type:a.expression.type.expression,value:c.match[1]}).stack;delete c.match;return c},parse:function(c,b,d){var e="";d&&a.expression.parse(c.stack,b)===true&&(d=false,e=a.parse(c.output,b));return{chain:d,output:e}}},{type:a.logic.type.else_,regex:/^else$/,next:[a.logic.type.endif,a.logic.type.endfor],
open:false,parse:function(c,b,d){var e="";d&&(e=a.parse(c.output,b));return{chain:d,output:e}}},{type:a.logic.type.endif,regex:/^endif$/,next:[],open:false},{type:a.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].+)$/,next:[a.logic.type.else_,a.logic.type.endfor],open:true,compile:function(c){var b=c.match[1],d=c.match[2],e=null,e=null;c.key_var=null;c.value_var=null;if(b.indexOf(",")>=0)if(e=b.split(","),e.length===2)c.key_var=e[0].trim(),c.value_var=e[1].trim();else throw new a.Error("Invalid expression in for loop: "+
b);else c.value_var=b;e=a.expression.compile({type:a.expression.type.expression,value:d}).stack;c.expression=e;delete c.match;return c},parse:function(c,b,d){var e=a.expression.parse(c.expression,b),f=[],g;e instanceof Array?(g=0,e.forEach(function(d){b[c.value_var]=d;c.key_var&&(b[c.key_var]=g);f.push(a.parse(c.output,b));g+=1})):e instanceof Object&&(d=e._keys!==void 0?e._keys:Object.keys(e),d.forEach(function(d){d!=="_keys"&&e.hasOwnProperty(d)&&(b[c.value_var]=e[d],c.key_var&&(b[c.key_var]=d),
f.push(a.parse(c.output,b)))}));d=f.length===0;return{chain:d,output:f.join("")}}},{type:a.logic.type.endfor,regex:/^endfor$/,next:[],open:false},{type:a.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*(.+)$/,next:[],open:true,compile:function(c){var b=c.match[1].trim(),d=a.expression.compile({type:a.expression.type.expression,value:c.match[2]}).stack;c.key=b;c.expression=d;delete c.match;return c},parse:function(c,b,d){var e=a.expression.parse(c.expression,b);b[c.key]=e;return{chain:d,context:b}}}];
a.logic.handler={};a.logic.extendType=function(c,b){a.logic.type[c]=b||c};for(a.logic.extend=function(c){if(!c.type)throw new a.Error("Unable to extend logic definition. No type provided for "+c);a.logic.handler[c.type]=c};a.logic.definitions.length>0;)a.logic.extend(a.logic.definitions.shift());a.logic.compile=function(c){var c=c.value.trim(),c=a.logic.tokenize(c),b=a.logic.handler[c.type];a.log.trace("Twig.logic.compile: ","Compiling logic token ",c);b.compile&&(c=b.compile(c),a.log.trace("Twig.logic.compile: ",
"Compiled logic token to ",c));return c};a.logic.tokenize=function(c){var b={},d=null,e=null,f=null,g=null,f=f=null,c=c.trim();for(d in a.logic.handler)if(a.logic.handler.hasOwnProperty(d)){e=a.logic.handler[d].type;f=a.logic.handler[d].regex;g=[];for(f instanceof Array?g=f:g.push(f);g.length>0;)if(f=g.shift(),f=f.exec(c.trim()),f!==null)return b.type=e,b.match=f,a.log.trace("Twig.logic.tokenize: ","Matched a ",e," regular expression of ",f),b}throw new a.Error("Unable to parse '"+c.trim()+"'");};
a.logic.parse=function(c,b,d){var e="",f,b=b||{};a.log.trace("Twig.logic.parse: ","Parsing logic token ",c);f=a.logic.handler[c.type];f.parse&&(e=f.parse(c,b,d));return e};return a}(Twig||{});
Twig=function(a){a.expression={};a.expression.type={comma:"Twig.expression.type.comma",expression:"Twig.expression.type.expression",operator:"Twig.expression.type.operator",string:"Twig.expression.type.string",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",
brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",setkey:"Twig.expression.type.setkey"};a.expression.definitions=[{type:a.expression.type.setkey,regex:/^\:/,next:[a.expression.type.expression,a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start],compile:function(c,b,d){var e=d.pop();if(e.type!==a.expression.type.string)throw new a.Error("Unexpected object key: "+
e);c.key=e.value;d.push(c);return{stack:b,output:d}},parse:function(a,b,d){b.push(a);return{stack:b,context:d}}},{type:a.expression.type.comma,regex:/^,/,next:[a.expression.type.expression,a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start],compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a);return{stack:b,output:d}}},{type:a.expression.type.expression,regex:/^\([^\)]+\)/,next:[a.expression.type.operator,
a.expression.type.array.end],compile:function(c,b,d){c.value=c.value.substring(1,c.value.length-1);for(c=a.expression.compile(c).stack;c.length>0;)d.push(c.shift());return{stack:b,output:d}}},{type:a.expression.type.operator,regex:/(^[\+\*\/\-\^~%]|^[<>!]=?|^==|^\|\||^&&)/,next:[a.expression.type.expression,a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start],compile:function(c,b,d){c=a.expression.operator.lookup(c.value,
c);for(a.log.trace("Twig.expression.compile: ","Operator: ",c);b.length>0&&(c.associativity===a.expression.operator.leftToRight&&c.precidence>=b[b.length-1].precidence||c.associativity===a.expression.operator.rightToLeft&&c.precidence>b[b.length-1].precidence);)d.push(b.pop());b.push(c);return{stack:b,output:d}},parse:function(c,b,d){b=a.expression.operator.parse(c.value,b);return{stack:b,context:d}}},{type:a.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2.)*?\1/,next:[a.expression.type.filter,
a.expression.type.operator,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.setkey],compile:function(c,b,d){var e=c.value,e=e.substring(0,1)==='"'?e.replace('\\"','"'):e.replace("\\'","'");c.value=e.substring(1,e.length-1);a.log.trace("Twig.expression.compile: ","String value: ",c.value);d.push(c);return{stack:b,output:d}},parse:function(a,b,d){b.push(a.value);return{stack:b,context:d}}},{type:a.expression.type.parameter.start,
regex:/^\(/,next:[a.expression.type.expression,a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.object.start,a.expression.type.array.start,a.expression.type.parameter.end],compile:function(a,b,d){d.push(a);return{stack:b,output:d}},parse:function(a,b,d){b.push(a);return{stack:b,context:d}}},{type:a.expression.type.parameter.end,regex:/^\)/,next:[a.expression.type.filter,a.expression.type.operator,a.expression.type.array.end,a.expression.type.object.end,
a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.setkey],compile:function(c,b,d){for(;b.length>0;)d.push(b.pop());for(var e=[];c.type!==a.expression.type.parameter.start;)e.unshift(c),c=d.pop();e.unshift(c);c=d.pop();if(c.type!==a.expression.type.filter)throw new a.Error("Expected filter before parameters, got "+c.type);c.params=e;d.push(c);return{stack:b,output:d}},parse:function(c,b,d){for(var c=[],e=false,f=null;b.length>0;){f=b.pop();if(f.type&&f.type==a.expression.type.parameter.start){e=
true;break}c.unshift(f)}if(!e)throw new a.Error("Expected end of parameter set.");b.push(c);return{stack:b,context:d}}},{type:a.expression.type.array.start,regex:/^\[/,next:[a.expression.type.expression,a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.end],compile:function(a,b,d){d.push(a);return{stack:b,output:d}},parse:function(a,b,d){b.push(a);return{stack:b,context:d}}},{type:a.expression.type.array.end,regex:/^\]/,next:[a.expression.type.filter,
a.expression.type.comma,a.expression.type.parameter.end,a.expression.type.array.end,a.expression.type.object.end],compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a);return{stack:b,output:d}},parse:function(c,b,d){for(var c=[],e=false,f=null;b.length>0;){f=b.pop();if(f.type&&f.type==a.expression.type.array.start){e=true;break}c.unshift(f)}if(!e)throw new a.Error("Expected end of array.");b.push(c);return{stack:b,context:d}}},{type:a.expression.type.object.start,regex:/^\{/,next:[a.expression.type.expression,
a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start],compile:function(a,b,d){d.push(a);return{stack:b,output:d}},parse:function(a,b,d){b.push(a);return{stack:b,context:d}}},{type:a.expression.type.object.end,regex:/^\}/,next:[a.expression.type.filter,a.expression.type.comma,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.array.end,a.expression.type.parameter.end,a.expression.type.key.period,
a.expression.type.key.brackets],compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a);return{stack:b,output:d}},parse:function(c,b,d){for(var c={},e=false,f=null,g=null;b.length>0;){f=b.pop();if(f.type&&f.type===a.expression.type.object.start){e=true;break}if(f.type&&f.type===a.expression.type.setkey){if(g===null)throw new a.Error("Expected value for key "+f.key+" in object definition. Got "+f);c[f.key]=g;if(c._keys===void 0)c._keys=[];c._keys.unshift(f.key);g=null}else g=f}if(!e)throw new a.Error("Unexpected end of object.");
b.push(c);return{stack:b,context:d}}},{type:a.expression.type.filter,regex:/(^\|[a-zA-Z_][a-zA-Z0-9_\-]*)/,next:[a.expression.type.comma,a.expression.type.filter,a.expression.type.operator,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.key.period,a.expression.type.key.brackets,a.expression.type.parameter.start],compile:function(a,b,d){a.value=a.value.substr(1);d.push(a);return{stack:b,output:d}},parse:function(c,b,d){if(a.filters[c.value]===
void 0)throw"Unable to find filter "+c.value;var e=b.pop(),f=c.params&&a.expression.parse(c.params,d);b.push(a.filters[c.value].parse(e,f));return{stack:b,context:d}}},{type:a.expression.type.variable,regex:/(^[a-zA-Z_][a-zA-Z0-9_]*)/,next:[a.expression.type.operator,a.expression.type.filter,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.key.period,a.expression.type.key.brackets],compile:function(a,b,d){d.push(a);
return{stack:b,output:d}},parse:function(a,b,d){d.hasOwnProperty(a.value);b.push(d[a.value]);return{stack:b,context:d}}},{type:a.expression.type.key.period,regex:/^(\.[a-zA-Z_][a-zA-Z0-9_]*)/,next:[a.expression.type.operator,a.expression.type.filter,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.key.period,a.expression.type.key.brackets],compile:function(a,b,d){a.key=a.value.substr(1);delete a.value;d.push(a);return{stack:b,
output:d}},parse:function(c,b,d){var c=c.key,e=b.pop();if(e===null||e===void 0)throw new a.Error("Can't access a key "+c+" on an undefined object.");e.hasOwnProperty(c);b.push(e[c]);return{stack:b,context:d}}},{type:a.expression.type.key.brackets,regex:/^\[[^\]]*\]/,next:[a.expression.type.operator,a.expression.type.filter,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.key.period,a.expression.type.key.brackets],compile:function(c,
b,d){c.value=c.value.substring(1,c.value.length-1);c.stack=a.expression.compile({value:c.value}).stack;delete c.value;d.push(c);return{stack:b,output:d}},parse:function(c,b,d){var c=a.expression.parse(c.stack,d),e=b.pop();if(!e.hasOwnProperty(c))throw new a.Error("Model doesn't provide the key "+c);b.push(e[c]);return{stack:b,context:d}}},{type:a.expression.type.number,regex:/(^\-?\d*\.?\d+)/,next:[a.expression.type.operator,a.expression.type.filter,a.expression.type.array.end,a.expression.type.object.end,
a.expression.type.parameter.end,a.expression.type.comma],compile:function(a,b,d){d.push(a);return{stack:b,output:d}},parse:function(a,b,d){b.push(a.value);return{stack:b,context:d}}}];a.expression.handler={};a.expression.extendType=function(c,b){a.expression.type[c]=b||c};for(a.expression.extend=function(c){if(!c.type)throw new a.Error("Unable to extend logic definition. No type provided for "+c);a.expression.handler[c.type]=c};a.expression.definitions.length>0;)a.expression.extend(a.expression.definitions.shift());
a.expression.tokenize=function(c){var b=[],d=0,e=null,f,g,h,k,j,i,l=[],m=function(c){a.log.trace("Twig.expression.tokenize","Matched a ",g," regular expression of ",c);f=b.length>0?b[b.length-1]:null;if(e!==null&&e.indexOf(g)<0)return l.push(g+" cannot follow a "+f.type+" at template:"+d+" near '"+c.substring(0,20)+"'"),c;l=[];b.push({type:g,value:c});i=true;e=j;d+=c.length;return""};for(a.log.debug("Twig.expression.tokenize","Tokenizing expression ",c);c.length>0;){c=c.trim();for(g in a.expression.handler)if(a.expression.handler.hasOwnProperty(g)){j=
a.expression.handler[g].next;h=a.expression.handler[g].regex;k=h instanceof Array?h:[h];for(i=false;k.length>0;)h=k.pop(),c=c.replace(h,m);if(i)break}if(!i)if(l.length>0)throw new a.Error(l.join(" OR "));else throw new a.Error("Unable to parse '"+c+"' at template position"+d);}a.log.trace("Twig.expression.tokenize","Tokenized to ",b);return b};a.expression.compile=function(c){var b=c.value,d=a.expression.tokenize(b),e=null,f=[],g=[],h=e=null;a.log.trace("Twig.expression.compile: ","Compiling ",b);
for(a.log.trace("Twig.expression.compile: ","Tokens tokenized to ",d);d.length>0;)e=d.shift(),h=a.expression.handler[e.type],h.compile&&(e=h.compile(e,g,f),f=e.output&&f,g=e.stack&&g);for(;g.length>0;)f.push(g.pop());a.log.trace("Twig.expression.compile: ","Stack is",f);c.stack=f;delete c.value;return c};a.expression.parse=function(c,b){c instanceof Array||(c=[c]);var d=[],e=null,f=null;c.forEach(function(c){e=a.expression.handler[c.type];a.log.trace("Twig.expression.parse: ","Parsing ",c);e.parse&&
(f=e.parse(c,d,b),d=f.stack&&d,b=f.context&&b);a.log.trace("Twig.expression.parse: ","Stack result: ",d)});return d.pop()};return a}(Twig||{});
Twig=function(a){a.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"};a.expression.operator.lookup=function(c,b){switch(c){case ",":b.precidence=18;b.associativity=a.expression.operator.leftToRight;break;case "?":case ":":b.precidence=16;b.associativity=a.expression.operator.rightToLeft;break;case "||":b.precidence=14;b.associativity=a.expression.operator.leftToRight;break;case "&&":b.precidence=13;b.associativity=a.expression.operator.leftToRight;break;case "==":case "!=":b.precidence=
9;b.associativity=a.expression.operator.leftToRight;break;case "<":case "<=":case ">":case ">=":b.precidence=8;b.associativity=a.expression.operator.leftToRight;break;case "~":case "+":case "-":b.precidence=6;b.associativity=a.expression.operator.leftToRight;break;case "*":case "/":case "%":b.precidence=5;b.associativity=a.expression.operator.leftToRight;break;case "!":b.precidence=3;b.associativity=a.expression.operator.rightToLeft;break;default:throw new a.Error(c+" is an unknown operator.");}b.operator=
c;return b};a.expression.operator.parse=function(c,b){a.log.trace("Twig.expression.operator.parse: ","Handling ",c);var d,e;switch(c){case "+":e=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d+e);break;case "-":e=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d-e);break;case "*":e=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d*e);break;case "/":e=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d/e);break;case "%":e=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d%e);break;case "~":e=b.pop().toString();
d=b.pop().toString();b.push(d+e);break;case "!":b.push(!b.pop());break;case "<":e=b.pop();d=b.pop();b.push(d<e);break;case "<=":e=b.pop();d=b.pop();b.push(d<=e);break;case ">":e=b.pop();d=b.pop();b.push(d>e);break;case ">=":e=b.pop();d=b.pop();b.push(d>=e);break;case "==":e=b.pop();d=b.pop();b.push(d==e);break;case "!=":e=b.pop();d=b.pop();b.push(d!=e);break;case "||":e=b.pop();d=b.pop();b.push(d||e);break;case "&&":e=b.pop(),d=b.pop(),b.push(d&&e)}return b};return a}(Twig||{});
Twig=function(a){a.filters={};a.filters={upper:{parse:function(a){return a.toUpperCase()}},lower:{parse:function(a){return a.toLowerCase()}},capitalize:{parse:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}},title:{parse:function(a){return a.replace(/(^|\s)([a-z])/g,function(a,c,e){return c+e.toUpperCase()})}},length:{parse:function(a){if(a instanceof Array||typeof a==="string")return a.length;else if(a instanceof Object)return a._keys===void 0?Object.keys(a).length:a._keys.length}},reverse:{parse:function(a){if(a instanceof
Array)return a.reverse();else if(a instanceof Object){var b=a._keys||Object.keys(a).reverse();a._keys=b;return a}}},sort:{parse:function(a){if(a instanceof Array)return a.sort();else if(a instanceof Object){var b=Object.keys(a).sort(function(b,e){return a[b]>a[e]});b.forEach(function(){});a._keys=b;return a}}},keys:{parse:function(a){var b=[];(a._keys||Object.keys(a)).forEach(function(d){d!=="_keys"&&a.hasOwnProperty(d)&&b.push(d)});return b}},url_encode:{parse:function(a){return encodeURIComponent(a)}},
join:{parse:function(a,b){var d="",e=[],f=null;b&&b[0]&&(d=b[0]);a instanceof Array?e=a:(f=a._keys||Object.keys(a),f.forEach(function(b){b!=="_keys"&&a.hasOwnProperty(b)&&e.push(a[b])}));return e.join(d)}},"default":{parse:function(c,b){if(b===void 0||b.length!==1)throw new a.Error("default filter expects one argument");return c===void 0||c===null||c===""?b[0]:c}},json_encode:{parse:function(a){delete a._keys;return JSON.stringify(a)}},merge:{parse:function(c,b){var d=[],e=0,f=[];c instanceof Array?
b.forEach(function(a){a instanceof Array||(d={})}):d={};if(!(d instanceof Array))d._keys=[];c instanceof Array?c.forEach(function(a){d._keys&&d._keys.unshift(e);d[e]=a;e++}):(f=c._keys||Object.keys(c),f.forEach(function(a){d[a]=c[a];d._keys.push(a);a=parseInt(a,10);!isNaN(a)&&a>=e&&(e=a+1)}));b.forEach(function(a){a instanceof Array?a.forEach(function(a){d._keys&&d._keys.push(e);d[e]=a;e++}):(f=a._keys||Object.keys(a),f.forEach(function(b){d[b]||d._keys.unshift(b);d[b]=a[b];b=parseInt(b,10);!isNaN(b)&&
b>=e&&(e=b+1)}))});if(b.length===0)throw new a.Error("Filter merge expects at least one parameter");return d}}};return a}(Twig||{});typeof module!=="undefined"&&module.exports?module.exports=twig:window.twig=twig;
