var Twig=function(a){function b(a,c){var b=Object.prototype.toString.call(c).slice(8,-1);return c!==void 0&&c!==null&&b===a}function c(a,c){var b=a.split("/"),g=[],h;b.pop();for(b=b.concat(c.split("/"));b.length>0;)h=b.shift(),h!="."&&(h==".."&&g.length>0&&g[g.length-1]!=".."?g.pop():g.push(h));return g.join("/")}a.trace=false;a.debug=false;a.Error=function(a){this.message=a;this.type=this.name="TwigException"};a.Error.prototype.toString=function(){return this.name+": "+this.message};a.log={trace:function(){a.trace&&
console&&console.log(Array.prototype.slice.call(arguments))},debug:function(){a.debug&&console&&console.log(Array.prototype.slice.call(arguments))}};a.token={};a.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw"};a.token.definitions={output:{type:a.token.type.output,open:"{{",close:"}}"},logic:{type:a.token.type.logic,open:"{%",close:"%}"},comment:{type:a.token.type.comment,open:"{#",close:"#}"}};a.token.strings=['"',"'"];a.token.findStart=function(c){var b={position:null,def:null},
f,g,h;for(f in a.token.definitions)if(a.token.definitions.hasOwnProperty(f)&&(g=a.token.definitions[f],h=c.indexOf(g.open),a.log.trace("Twig.token.findStart: ","Searching for ",g.open," found at ",h),h>=0&&(b.position===null||h<b.position)))b.position=h,b.def=g;return b};a.token.findEnd=function(c,b,f){for(var g=null,h=false,i=0,j=null,l=null,k=null,m=j=null,j=null,n,o;!h;){l=j=null;k=c.indexOf(b.close,i);if(k>=0)g=k,h=true;else throw new a.Error("Unable to find closing bracket '"+b.close+"' opened near template position "+
f);o=a.token.strings.length;for(n=0;n<o;n+=1)if(m=c.indexOf(a.token.strings[n],i),m>0&&m<k&&(j===null||m<j))j=m,l=a.token.strings[n];if(j!==null){j+=1;g=null;for(h=false;;){j=c.indexOf(l,j);if(j<0)throw"Unclosed string in template";if(c.substr(j-1,1)!=="\\"){i=j+1;break}else j+=1}}}return g};a.tokenize=function(c){for(var b=[],f=0,g=null,h=null;c.length>0;)g=a.token.findStart(c),a.log.trace("Twig.tokenize: ","Found token: ",g),g.position!==null?(g.position>0&&b.push({type:a.token.type.raw,value:c.substring(0,
g.position)}),c=c.substr(g.position+g.def.open.length),f+=g.position+g.def.open.length,h=a.token.findEnd(c,g.def,f),a.log.trace("Twig.tokenize: ","Token ends at ",h),b.push({type:g.def.type,value:c.substring(0,h).trim()}),c=c.substr(h+g.def.close.length),f+=h+g.def.close.length):(b.push({type:a.token.type.raw,value:c}),c="");return b};a.compile=function(c){for(var b=[],f=[],g=[],h=null,i=h=h=null,j=null,l=i=null,k=null,m=null;c.length>0;){h=c.shift();a.log.trace("Compiling token ",h);switch(h.type){case a.token.type.raw:f.length>
0?g.push(h):b.push(h);break;case a.token.type.logic:h=a.logic.compile.apply(this,[h]);l=h.type;k=a.logic.handler[l].open;m=a.logic.handler[l].next;a.log.trace("Twig.compile: ","Compiled logic token to ",h," next is: ",m," open is : ",k);if(k!==void 0&&!k){i=f.pop();j=a.logic.handler[i.type];if(j.next.indexOf(l)<0)throw Error(l+" not expected after a "+i.type);i.output=i.output||[];i.output=i.output.concat(g);g=[];i={type:a.token.type.logic,token:i};f.length>0?g.push(i):b.push(i)}if(m!==void 0&&m.length>
0){a.log.trace("Twig.compile: ","Pushing ",h," to logic stack.");if(f.length>0)i=f.pop(),i.output=i.output||[],i.output=i.output.concat(g),f.push(i);f.push(h)}else k!==void 0&&k&&(i={type:a.token.type.logic,token:h},f.length>0?g.push(i):b.push(i));break;case a.token.type.output:a.expression.compile.apply(this,[h]),f.length>0?g.push(h):b.push(h)}a.log.trace("Twig.compile: "," Output: ",b," Logic Stack: ",f," Pending Output: ",g)}if(f.length>0)throw h=f.pop(),Error("Unable to find an end tag for "+
h.type+", expecting one of "+h.next.join(", "));return b};a.parse=function(c,b){var f=[],g=true,h=this,b=b||{};c.forEach(function(c){a.log.debug("Twig.parse: ","Parsing token: ",c);switch(c.type){case a.token.type.raw:f.push(c.value);break;case a.token.type.logic:c=a.logic.parse.apply(h,[c.token,b,g]);if(c.chain!==void 0)g=c.chain;if(c.context!==void 0)b=c.context;c.output!==void 0&&f.push(c.output);break;case a.token.type.output:f.push(a.expression.parse.apply(h,[c.stack,b]))}});return f.join("")};
a.prepare=function(c){a.log.debug("Twig.prepare: ","Tokenizing ",c);c=a.tokenize.apply(this,[c]);a.log.debug("Twig.prepare: ","Compiling ",c);c=a.compile.apply(this,[c]);a.log.debug("Twig.prepare: ","Compiled ",c);return c};a.Templates={registry:{}};a.validateId=function(c){if(c==="prototype")throw new a.Error(c+" is not a valid twig identifier");else if(a.Templates.registry.hasOwnProperty(c))throw new a.Error("There is already a template with the ID "+c);return true};a.Templates.save=function(c){if(c.id===
void 0)throw new a.Error("Unable to save template with no id");a.Templates.registry[c.id]=c};a.Templates.load=function(c){return!a.Templates.registry.hasOwnProperty(c)?null:a.Templates.registry[c]};a.Templates.loadRemote=function(c,b,f,g){var h=b.id,i=b.blocks,j=b.precompiled,l=null;h===void 0&&(h=c);if(a.Templates.registry.hasOwnProperty(h))return a.Templates.registry.hasOwnProperty(h);if(typeof XMLHttpRequest=="undefined")throw Error("Unsupported platform: Unable to do remote requests because there is no XMLHTTPRequest implementation");
var k=new XMLHttpRequest;k.onreadystatechange=function(){var b=null;if(k.readyState==4)a.log.debug("Got template ",k.responseText),j===true?(b=JSON.parse(k.responseText),l=new a.Template({data:b,blocks:i,id:h})):(l=new a.Template({data:k.responseText,blocks:i,id:h}),l.url=c),g&&g(l)};k.open("GET",c,f===true);k.send();if(f===false)return l};a.Template=function(d){var e=d.data,f=d.id,d=d.blocks,g;this.id=f;this.blocks=d||{};this.extend=null;this.tokens=b("String",e)?a.prepare.apply(this,[e]):e;this.render=
function(b,d){var e=this,f,k=d&&d.output=="blocks";this.importBlocks=function(d,f){var g=c(e.url,d),i=a.Templates.loadRemote(g,{id:g},false),f=f||false;i.render(b);Object.keys(i.blocks).forEach(function(c){if(f||e.blocks[c]===void 0)e.blocks[c]=i.blocks[c]})};f=a.parse.apply(this,[this.tokens,b]);return this.extend?(g=c(this.url,this.extend),this.parent=a.Templates.loadRemote(g,{id:g,blocks:this.blocks},false),this.parent.blocks=this.blocks,this.parent.render(b)):k===true?this.blocks:f};f!==void 0&&
a.Templates.save(this)};return a}(Twig||{});
(function(){if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(c===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=d>=0?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){var c,d;if(this==
null)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if({}.toString.call(a)!="[object Function]")throw new TypeError(a+" is not a function");b&&(c=b);for(d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e));d++}};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}})();
Twig=function(a){a.logic={};a.logic.type={if_:"Twig.logic.type.if",endif:"Twig.logic.type.endif",for_:"Twig.logic.type.for",endfor:"Twig.logic.type.endfor",else_:"Twig.logic.type.else",elseif:"Twig.logic.type.elseif",set:"Twig.logic.type.set",filter:"Twig.logic.type.filter",endfilter:"Twig.logic.type.endfilter",block:"Twig.logic.type.block",endblock:"Twig.logic.type.endblock",extends_:"Twig.logic.type.extends",use:"Twig.logic.type.use"};a.logic.definitions=[{type:a.logic.type.if_,regex:/^if\s+([^\s].+)$/,
next:[a.logic.type.else_,a.logic.type.elseif,a.logic.type.endif],open:true,compile:function(b){b.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b.match[1]}]).stack;delete b.match;return b},parse:function(b,c,d){var e="",f=a.expression.parse.apply(this,[b.stack,c]),d=true;f===true&&(d=false,e=a.parse.apply(this,[b.output,c]));return{chain:d,output:e}}},{type:a.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[a.logic.type.else_,a.logic.type.endif],open:false,compile:function(b){b.stack=
a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b.match[1]}]).stack;delete b.match;return b},parse:function(b,c,d){var e="";d&&a.expression.parse.apply(this,[b.stack,c])===true&&(d=false,e=a.parse.apply(this,[b.output,c]));return{chain:d,output:e}}},{type:a.logic.type.else_,regex:/^else$/,next:[a.logic.type.endif,a.logic.type.endfor],open:false,parse:function(b,c,d){var e="";d&&(e=a.parse.apply(this,[b.output,c]));return{chain:d,output:e}}},{type:a.logic.type.endif,regex:/^endif$/,
next:[],open:false},{type:a.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].+)$/,next:[a.logic.type.else_,a.logic.type.endfor],open:true,compile:function(b){var c=b.match[1],d=b.match[2],e=null,e=null;b.key_var=null;b.value_var=null;if(c.indexOf(",")>=0)if(e=c.split(","),e.length===2)b.key_var=e[0].trim(),b.value_var=e[1].trim();else throw new a.Error("Invalid expression in for loop: "+c);else b.value_var=c;e=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:d}]).stack;
b.expression=e;delete b.match;return b},parse:function(b,c,d){var e=a.expression.parse.apply(this,[b.expression,c]),f=[],g;e instanceof Array?(g=0,e.forEach(function(d){c[b.value_var]=d;b.key_var&&(c[b.key_var]=g);f.push(a.parse.apply(this,[b.output,c]));g+=1})):e instanceof Object&&(d=e._keys!==void 0?e._keys:Object.keys(e),d.forEach(function(d){d!=="_keys"&&e.hasOwnProperty(d)&&(c[b.value_var]=e[d],b.key_var&&(c[b.key_var]=d),f.push(a.parse.apply(this,[b.output,c])))}));d=f.length===0;return{chain:d,
output:f.join("")}}},{type:a.logic.type.endfor,regex:/^endfor$/,next:[],open:false},{type:a.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*(.+)$/,next:[],open:true,compile:function(b){var c=b.match[1].trim(),d=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b.match[2]}]).stack;b.key=c;b.expression=d;delete b.match;return b},parse:function(b,c,d){var e=a.expression.parse.apply(this,[b.expression,c]);c[b.key]=e;return{chain:d,context:c}}},{type:a.logic.type.filter,regex:/^filter\s+(.+)$/,
next:[a.logic.type.endfilter],open:true,compile:function(b){var c="|"+b.match[1].trim();b.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c}]).stack;delete b.match;return b},parse:function(b,c,d){var e=a.parse.apply(this,[b.output,c]),b=[{type:a.expression.type.string,value:e}].concat(b.stack),c=a.expression.parse.apply(this,[b,c]);return{chain:d,output:c}}},{type:a.logic.type.endfilter,regex:/^endfilter$/,next:[],open:false},{type:a.logic.type.block,regex:/^block\s+([a-zA-Z0-9_]+)$/,
next:[a.logic.type.endblock],open:true,compile:function(a){a.block=a.match[1].trim();delete a.match;return a},parse:function(b,c,d){var e="",f="";this.blocks[b.block]===void 0&&(e=a.expression.parse.apply(this,[{type:a.expression.type.string,value:a.parse.apply(this,[b.output,c])},c]),this.blocks[b.block]=e);this.extend===null&&(f=this.blocks[b.block]);return{chain:d,output:f}}},{type:a.logic.type.endblock,regex:/^endblock$/,next:[],open:false},{type:a.logic.type.extends_,regex:/^extends\s+(.+)$/,
next:[],open:true,compile:function(b){var c=b.match[1].trim();delete b.match;b.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c}]).stack;return b},parse:function(b,c,d){this.extend=a.expression.parse.apply(this,[b.stack,c]);return{chain:d,output:""}}},{type:a.logic.type.use,regex:/^use\s+(.+)$/,next:[],open:true,compile:function(b){var c=b.match[1].trim();delete b.match;b.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c}]).stack;return b},
parse:function(b,c,d){this.importBlocks(a.expression.parse.apply(this,[b.stack,c]));return{chain:d,output:""}}}];a.logic.handler={};a.logic.extendType=function(b,c){a.logic.type[b]=c||"Twig.logic.type"+b};for(a.logic.extend=function(b){if(!b.type)throw new a.Error("Unable to extend logic definition. No type provided for "+b);if(a.logic.type[b.type])throw new a.Error("Unable to extend logic definitions. Type "+b.type+" is already defined.");else a.logic.extendType(b.type);a.logic.handler[b.type]=b};a.logic.definitions.length>
0;)a.logic.extend(a.logic.definitions.shift());a.logic.compile=function(b){var b=b.value.trim(),b=a.logic.tokenize.apply(this,[b]),c=a.logic.handler[b.type];c.compile&&(b=c.compile.apply(this,[b]),a.log.trace("Twig.logic.compile: ","Compiled logic token to ",b));return b};a.logic.tokenize=function(b){var c={},d=null,e=null,f=null,g=null,f=f=null,b=b.trim();for(d in a.logic.handler)if(a.logic.handler.hasOwnProperty(d)){e=a.logic.handler[d].type;f=a.logic.handler[d].regex;g=[];for(f instanceof Array?
g=f:g.push(f);g.length>0;)if(f=g.shift(),f=f.exec(b.trim()),f!==null)return c.type=e,c.match=f,a.log.trace("Twig.logic.tokenize: ","Matched a ",e," regular expression of ",f),c}throw new a.Error("Unable to parse '"+b.trim()+"'");};a.logic.parse=function(b,c,d){var e="",f,c=c||{};a.log.debug("Twig.logic.parse: ","Parsing logic token ",b);f=a.logic.handler[b.type];f.parse&&(e=f.parse.apply(this,[b,c,d]));return e};return a}(Twig||{});
Twig=function(a){a.expression={};a.expression.type={comma:"Twig.expression.type.comma",expression:"Twig.expression.type.expression",operator:"Twig.expression.type.operator",string:"Twig.expression.type.string",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",
brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",setkey:"Twig.expression.type.setkey",test:"Twig.expression.type.test"};a.expression.set={operations:[a.expression.type.filter,a.expression.type.operator,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.setkey,a.expression.type.test],expressions:[a.expression.type.expression,
a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start]};a.expression.fn={compile:{push:function(a,c,d){d.push(a)}},parse:{push:function(a,c){c.push(a)},push_value:function(a,c){c.push(a.value)}}};a.expression.definitions=[{type:a.expression.type.test,regex:/^is\s+(not)?\s*([a-zA-Z_][a-zA-Z0-9_]*)/,next:a.expression.set.operations.concat([a.expression.type.parameter.start]),compile:function(a,c,d){a.filter=a.match[2];
a.modifier=a.match[1];delete a.match;delete a.value;d.push(a)},parse:function(b,c,d){var e=c.pop(),d=b.params&&a.expression.parse.apply(this,[b.params,d]),e=a.test(b.filter,e,d);b.modifier=="not"?c.push(!e):c.push(e)}},{type:a.expression.type.setkey,regex:/^\:/,next:a.expression.set.expressions,compile:function(b,c,d){c=d.pop();if(c.type!==a.expression.type.string)throw new a.Error("Unexpected object key: "+c);b.key=c.value;d.push(b)},parse:a.expression.fn.parse.push},{type:a.expression.type.comma,
regex:/^,/,next:a.expression.set.expressions,compile:function(a,c,d){for(;c.length>0;)d.push(c.pop());d.push(a)}},{type:a.expression.type.expression,regex:/^\(([^\)]+)\)/,next:a.expression.set.operations,compile:function(b,c,d){b.value=b.match[1];for(b=a.expression.compile(b).stack;b.length>0;)d.push(b.shift())}},{type:a.expression.type.operator,regex:/(^[\+\*\/\-\^~%]|^[<>!]=?|^==|^\|\||^&&)/,next:a.expression.set.expressions,compile:function(b,c,d){b=a.expression.operator.lookup(b.value,b);for(a.log.trace("Twig.expression.compile: ",
"Operator: ",b);c.length>0&&(b.associativity===a.expression.operator.leftToRight&&b.precidence>=c[c.length-1].precidence||b.associativity===a.expression.operator.rightToLeft&&b.precidence>c[c.length-1].precidence);)d.push(c.pop());c.push(b)},parse:function(b,c){a.expression.operator.parse(b.value,c)}},{type:a.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2.)*?\1/,next:a.expression.set.operations,compile:function(b,c,d){c=b.value;c=c.substring(0,1)==='"'?c.replace('\\"','"'):c.replace("\\'","'");
b.value=c.substring(1,c.length-1);a.log.trace("Twig.expression.compile: ","String value: ",b.value);d.push(b)},parse:a.expression.fn.parse.push_value},{type:a.expression.type.parameter.start,regex:/^\(/,next:a.expression.set.expressions.concat([a.expression.type.parameter.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.parameter.end,regex:/^\)/,next:a.expression.set.operations,compile:function(b,c,d){for(;c.length>0;)d.push(c.pop());for(c=[];b.type!==
a.expression.type.parameter.start;)c.unshift(b),b=d.pop();c.unshift(b);b=d.pop();if(b.type!==a.expression.type.filter&&b.type!==a.expression.type.test)throw new a.Error("Expected filter before parameters, got "+b.type);b.params=c;d.push(b)},parse:function(b,c){for(var d=[],e=false,f=null;c.length>0;){f=c.pop();if(f.type&&f.type==a.expression.type.parameter.start){e=true;break}d.unshift(f)}if(!e)throw new a.Error("Expected end of parameter set.");c.push(d)}},{type:a.expression.type.array.start,regex:/^\[/,
next:a.expression.set.expressions.concat([a.expression.type.array.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.array.end,regex:/^\]/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,c,d){for(;c.length>0;)d.push(c.pop());d.push(a)},parse:function(b,c){for(var d=[],e=false,f=null;c.length>0;){f=c.pop();if(f.type&&f.type==a.expression.type.array.start){e=true;break}d.unshift(f)}if(!e)throw new a.Error("Expected end of array.");
c.push(d)}},{type:a.expression.type.object.start,regex:/^\{/,next:a.expression.set.expressions.concat([a.expression.type.object.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.object.end,regex:/^\}/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,c,d){for(;c.length>0;)d.push(c.pop());d.push(a)},parse:function(b,c){for(var d={},e=false,f=null,g=null;c.length>0;){f=c.pop();
if(f.type&&f.type===a.expression.type.object.start){e=true;break}if(f.type&&f.type===a.expression.type.setkey){if(g===null)throw new a.Error("Expected value for key "+f.key+" in object definition. Got "+f);d[f.key]=g;if(d._keys===void 0)d._keys=[];d._keys.unshift(f.key);g=null}else g=f}if(!e)throw new a.Error("Unexpected end of object.");c.push(d)}},{type:a.expression.type.filter,regex:/^\|[a-zA-Z_][a-zA-Z0-9_\-]*/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets,
a.expression.type.parameter.start]),compile:function(a,c,d){a.value=a.value.substr(1);d.push(a)},parse:function(b,c,d){var e=c.pop(),d=b.params&&a.expression.parse.apply(this,[b.params,d]);c.push(a.filter(b.value,e,d))}},{type:a.expression.type.variable,regex:/^[a-zA-Z_][a-zA-Z0-9_]*/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:a.expression.fn.compile.push,parse:function(b,c,d){b=a.expression.resolve(b.value,d);c.push(b)}},{type:a.expression.type.key.period,
regex:/^\.([a-zA-Z_][a-zA-Z0-9_]*)/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,c,d){a.key=a.match[1];delete a.match;delete a.value;d.push(a)},parse:function(b,c){var d=b.key,e=c.pop();if(e===null||e===void 0)throw new a.Error("Can't access a key "+d+" on an undefined object.");c.push(e[d])}},{type:a.expression.type.key.brackets,regex:/^\[([^\]]*)\]/,next:a.expression.set.operations.concat([a.expression.type.key.period,
a.expression.type.key.brackets]),compile:function(b,c,d){c=b.match[1];delete b.value;delete b.match;b.stack=a.expression.compile({value:c}).stack;d.push(b)},parse:function(b,c,d){b=a.expression.parse.apply(this,[b.stack,d]);d=c.pop();if(!d.hasOwnProperty(b))throw new a.Error("Model doesn't provide the key "+b);c.push(d[b])}},{type:a.expression.type.number,regex:/^\-?\d*\.?\d+/,next:a.expression.set.operations,compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push_value}];a.expression.resolve=
function(a,c){var d=c[a];return typeof d=="function"?d.apply(c,[c]):d};a.expression.handler={};a.expression.extendType=function(b){a.expression.type[b]="Twig.expression.type."+b};for(a.expression.extend=function(b){if(!b.type)throw new a.Error("Unable to extend logic definition. No type provided for "+b);a.expression.handler[b.type]=b};a.expression.definitions.length>0;)a.expression.extend(a.expression.definitions.shift());a.expression.tokenize=function(b){var c=[],d=0,e=null,f,g,h,i,j,l=[],k;k=function(){var b=
Array.prototype.slice.apply(arguments);b.pop();b.pop();a.log.trace("Twig.expression.tokenize","Matched a ",f," regular expression of ",b);if(e&&e.indexOf(f)<0)return l.push(f+" cannot follow a "+c[c.length-1].type+" at template:"+d+" near '"+b[0].substring(0,20)+"...'"),b[0];l=[];c.push({type:f,value:b[0],match:b});j=true;e=i;d+=b[0].length;return""};for(a.log.debug("Twig.expression.tokenize","Tokenizing expression ",b);b.length>0;){b=b.trim();for(f in a.expression.handler)if(a.expression.handler.hasOwnProperty(f)){i=
a.expression.handler[f].next;g=a.expression.handler[f].regex;a.log.trace("Checking type ",f," on ",b);h=g instanceof Array?g:[g];for(j=false;h.length>0;)g=h.pop(),b=b.replace(g,k);if(j)break}if(!j)if(l.length>0)throw new a.Error(l.join(" OR "));else throw new a.Error("Unable to parse '"+b+"' at template position"+d);}a.log.trace("Twig.expression.tokenize","Tokenized to ",c);return c};a.expression.compile=function(b){var c=b.value,d=a.expression.tokenize(c),e=null,f=[],g=[],h=null;a.log.trace("Twig.expression.compile: ",
"Compiling ",c);for(a.log.trace("Twig.expression.compile: ","Tokens tokenized to ",d);d.length>0;)e=d.shift(),h=a.expression.handler[e.type],h.compile&&h.compile(e,g,f);for(;g.length>0;)f.push(g.pop());a.log.trace("Twig.expression.compile: ","Stack is",f);b.stack=f;delete b.value;return b};a.expression.parse=function(b,c){var d=this;b instanceof Array||(b=[b]);var e=[],f=null;b.forEach(function(b){f=a.expression.handler[b.type];f.parse&&f.parse.apply(d,[b,e,c])});return e.pop()};return a}(Twig||{});
Twig=function(a){a.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"};a.expression.operator.lookup=function(b,c){switch(b){case ",":c.precidence=18;c.associativity=a.expression.operator.leftToRight;break;case "?":case ":":c.precidence=16;c.associativity=a.expression.operator.rightToLeft;break;case "||":c.precidence=14;c.associativity=a.expression.operator.leftToRight;break;case "&&":c.precidence=13;c.associativity=a.expression.operator.leftToRight;break;case "==":case "!=":c.precidence=
9;c.associativity=a.expression.operator.leftToRight;break;case "<":case "<=":case ">":case ">=":c.precidence=8;c.associativity=a.expression.operator.leftToRight;break;case "~":case "+":case "-":c.precidence=6;c.associativity=a.expression.operator.leftToRight;break;case "*":case "/":case "%":c.precidence=5;c.associativity=a.expression.operator.leftToRight;break;case "!":c.precidence=3;c.associativity=a.expression.operator.rightToLeft;break;default:throw new a.Error(b+" is an unknown operator.");}c.operator=
b;return c};a.expression.operator.parse=function(b,c){a.log.trace("Twig.expression.operator.parse: ","Handling ",b);var d,e;switch(b){case "+":e=parseFloat(c.pop());d=parseFloat(c.pop());c.push(d+e);break;case "-":e=parseFloat(c.pop());d=parseFloat(c.pop());c.push(d-e);break;case "*":e=parseFloat(c.pop());d=parseFloat(c.pop());c.push(d*e);break;case "/":e=parseFloat(c.pop());d=parseFloat(c.pop());c.push(d/e);break;case "%":e=parseFloat(c.pop());d=parseFloat(c.pop());c.push(d%e);break;case "~":e=c.pop().toString();
d=c.pop().toString();c.push(d+e);break;case "!":c.push(!c.pop());break;case "<":e=c.pop();d=c.pop();c.push(d<e);break;case "<=":e=c.pop();d=c.pop();c.push(d<=e);break;case ">":e=c.pop();d=c.pop();c.push(d>e);break;case ">=":e=c.pop();d=c.pop();c.push(d>=e);break;case "==":e=c.pop();d=c.pop();c.push(d==e);break;case "!=":e=c.pop();d=c.pop();c.push(d!=e);break;case "||":e=c.pop();d=c.pop();c.push(d||e);break;case "&&":e=c.pop(),d=c.pop(),c.push(d&&e)}};return a}(Twig||{});
Twig=function(a){function b(a,b){var e=Object.prototype.toString.call(b).slice(8,-1);return b!==void 0&&b!==null&&e===a}a.filters={upper:function(a){return a.toUpperCase()},lower:function(a){return a.toLowerCase()},capitalize:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},title:function(a){return a.replace(/(^|\s)([a-z])/g,function(a,c,b){return c+b.toUpperCase()})},length:function(a){if(a instanceof Array||typeof a==="string")return a.length;else if(a instanceof Object)return a._keys===
void 0?Object.keys(a).length:a._keys.length},reverse:function(a){if(b("Array",a))return a.reverse();else if(b("String",a))return a.split("").reverse().join("");else{var d=a._keys||Object.keys(a).reverse();a._keys=d;return a}},sort:function(a){if(b("Array",a))return a.sort();else if(a instanceof Object){var d=Object.keys(a).sort(function(b,d){return a[b]>a[d]});d.forEach(function(){});a._keys=d;return a}},keys:function(a){var b=[];(a._keys||Object.keys(a)).forEach(function(e){e!=="_keys"&&a.hasOwnProperty(e)&&
b.push(e)});return b},url_encode:function(a){return encodeURIComponent(a)},join:function(a,b){var e="",f=[],g=null;b&&b[0]&&(e=b[0]);a instanceof Array?f=a:(g=a._keys||Object.keys(a),g.forEach(function(b){b!=="_keys"&&a.hasOwnProperty(b)&&f.push(a[b])}));return f.join(e)},"default":function(b,d){if(d===void 0||d.length!==1)throw new a.Error("default filter expects one argument");return b===void 0||b===null||b===""?d[0]:b},json_encode:function(a){delete a._keys;return JSON.stringify(a)},merge:function(b,
d){var e=[],f=0,g=[];b instanceof Array?d.forEach(function(a){a instanceof Array||(e={})}):e={};if(!(e instanceof Array))e._keys=[];b instanceof Array?b.forEach(function(a){e._keys&&e._keys.unshift(f);e[f]=a;f++}):(g=b._keys||Object.keys(b),g.forEach(function(a){e[a]=b[a];e._keys.push(a);a=parseInt(a,10);!isNaN(a)&&a>=f&&(f=a+1)}));d.forEach(function(a){a instanceof Array?a.forEach(function(a){e._keys&&e._keys.push(f);e[f]=a;f++}):(g=a._keys||Object.keys(a),g.forEach(function(b){e[b]||e._keys.unshift(b);
e[b]=a[b];b=parseInt(b,10);!isNaN(b)&&b>=f&&(f=b+1)}))});if(d.length===0)throw new a.Error("Filter merge expects at least one parameter");return e}};a.filter=function(b,d,e){if(!a.filters[b])throw"Unable to find filter "+b;return a.filters[b](d,e)};a.filter.extend=function(b,d){a.filters[b]=d};return a}(Twig||{});
Twig=function(a){a.tests={empty:function(a){if(a===null||a===void 0)return true;if(a.length&&a.length>0)return false;for(var c in a)if(a.hasOwnProperty(c))return false;return true},odd:function(a){return a%2===1},even:function(a){return a%2===0},divisibleby:function(a,c){return a%c[0]===0},defined:function(a){return a!==void 0},none:function(a){return a===null}};a.test=function(b,c,d){if(!a.tests[b])throw"Test "+b+" is not defined.";return a.tests[b](c,d)};a.test.extend=function(b,c){a.tests[b]=c};
return a}(Twig||{});
Twig=function(a){a.exports={};a.exports.twig=function(b){var c=b.id;c&&a.validateId(c);if(b.debug!==void 0)a.debug=b.debug;if(b.data!==void 0)return new a.Template({data:b.data,id:c});else if(b.ref!==void 0){if(b.id!==void 0)throw Error("Both ref and id cannot be set on a twig.js template.");return a.Templates.load(b.ref)}else if(b.href!==void 0)return a.Templates.loadRemote(b.href,{id:c,precompiled:b.precompiled},b.async,b.load)};a.exports.extendFilter=function(b,c){a.filter.extend(b,c)};a.exports.extendTest=
function(b,c){a.test.extend(b,c)};a.exports.extendTag=function(b){a.logic.extend(b)};a.exports.compile=function(b,c){var d=new a.Template({data:b,id:c.filename});return function(a){return d.render(a)}};return a}(Twig||{});typeof module!=="undefined"&&module.declare?module.declare([],function(a,b){for(key in Twig.exports)Twig.exports.hasOwnProperty(key)&&(b[key]=Twig.exports[key])}):typeof module!=="undefined"&&module.exports?module.exports=Twig.exports:(window.twig=Twig.exports.twig,window.Twig=Twig);
