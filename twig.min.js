var Twig=function(a){function c(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return b!==void 0&&b!==null&&c===a}function b(b,c){var e,h,g=[];if(b.url)e=b.url;else if(b.path)e=b.path;else throw new a.Error("Cannot extend an inline template.");h=e.split("/");h.pop();for(h=h.concat(c.split("/"));h.length>0;)e=h.shift(),e!="."&&(e==".."&&g.length>0&&g[g.length-1]!=".."?g.pop():g.push(e));return g.join("/")}a.trace=false;a.debug=false;a.Error=function(a){this.message=a;this.type=this.name=
"TwigException"};a.Error.prototype.toString=function(){return this.name+": "+this.message};a.log={trace:function(){a.trace&&console&&console.log(Array.prototype.slice.call(arguments))},debug:function(){a.debug&&console&&console.log(Array.prototype.slice.call(arguments))}};a.token={};a.token.type={output:"output",logic:"logic",comment:"comment",raw:"raw"};a.token.definitions={output:{type:a.token.type.output,open:"{{",close:"}}"},logic:{type:a.token.type.logic,open:"{%",close:"%}"},comment:{type:a.token.type.comment,
open:"{#",close:"#}"}};a.token.strings=['"',"'"];a.token.findStart=function(b){var c={position:null,def:null},e,h,g;for(e in a.token.definitions)if(a.token.definitions.hasOwnProperty(e)&&(h=a.token.definitions[e],g=b.indexOf(h.open),a.log.trace("Twig.token.findStart: ","Searching for ",h.open," found at ",g),g>=0&&(c.position===null||g<c.position)))c.position=g,c.def=h;return c};a.token.findEnd=function(b,c,e){for(var h=null,g=false,i=0,j=null,l=null,k=null,m=j=null,j=null,n,o;!g;){l=j=null;k=b.indexOf(c.close,
i);if(k>=0)h=k,g=true;else throw new a.Error("Unable to find closing bracket '"+c.close+"' opened near template position "+e);o=a.token.strings.length;for(n=0;n<o;n+=1)if(m=b.indexOf(a.token.strings[n],i),m>0&&m<k&&(j===null||m<j))j=m,l=a.token.strings[n];if(j!==null){j+=1;h=null;for(g=false;;){j=b.indexOf(l,j);if(j<0)throw"Unclosed string in template";if(b.substr(j-1,1)!=="\\"){i=j+1;break}else j+=1}}}return h};a.tokenize=function(b){for(var c=[],e=0,h=null,g=null;b.length>0;)h=a.token.findStart(b),
a.log.trace("Twig.tokenize: ","Found token: ",h),h.position!==null?(h.position>0&&c.push({type:a.token.type.raw,value:b.substring(0,h.position)}),b=b.substr(h.position+h.def.open.length),e+=h.position+h.def.open.length,g=a.token.findEnd(b,h.def,e),a.log.trace("Twig.tokenize: ","Token ends at ",g),c.push({type:h.def.type,value:b.substring(0,g).trim()}),b=b.substr(g+h.def.close.length),e+=g+h.def.close.length):(c.push({type:a.token.type.raw,value:b}),b="");return c};a.compile=function(b){for(var c=
[],e=[],h=[],g=null,i=g=g=null,j=null,l=i=null,k=null,m=null;b.length>0;){g=b.shift();a.log.trace("Compiling token ",g);switch(g.type){case a.token.type.raw:e.length>0?h.push(g):c.push(g);break;case a.token.type.logic:g=a.logic.compile.apply(this,[g]);l=g.type;k=a.logic.handler[l].open;m=a.logic.handler[l].next;a.log.trace("Twig.compile: ","Compiled logic token to ",g," next is: ",m," open is : ",k);if(k!==void 0&&!k){i=e.pop();j=a.logic.handler[i.type];if(j.next.indexOf(l)<0)throw Error(l+" not expected after a "+
i.type);i.output=i.output||[];i.output=i.output.concat(h);h=[];i={type:a.token.type.logic,token:i};e.length>0?h.push(i):c.push(i)}if(m!==void 0&&m.length>0){a.log.trace("Twig.compile: ","Pushing ",g," to logic stack.");if(e.length>0)i=e.pop(),i.output=i.output||[],i.output=i.output.concat(h),e.push(i);e.push(g)}else k!==void 0&&k&&(i={type:a.token.type.logic,token:g},e.length>0?h.push(i):c.push(i));break;case a.token.type.output:a.expression.compile.apply(this,[g]),e.length>0?h.push(g):c.push(g)}a.log.trace("Twig.compile: ",
" Output: ",c," Logic Stack: ",e," Pending Output: ",h)}if(e.length>0)throw g=e.pop(),Error("Unable to find an end tag for "+g.type+", expecting one of "+g.next.join(", "));return c};a.parse=function(b,c){var e=[],h=true,g=this,c=c||{};b.forEach(function(b){a.log.debug("Twig.parse: ","Parsing token: ",b);switch(b.type){case a.token.type.raw:e.push(b.value);break;case a.token.type.logic:b=a.logic.parse.apply(g,[b.token,c,h]);if(b.chain!==void 0)h=b.chain;if(b.context!==void 0)c=b.context;b.output!==
void 0&&e.push(b.output);break;case a.token.type.output:e.push(a.expression.parse.apply(g,[b.stack,c]))}});return e.join("")};a.prepare=function(b){a.log.debug("Twig.prepare: ","Tokenizing ",b);b=a.tokenize.apply(this,[b]);a.log.debug("Twig.prepare: ","Compiling ",b);b=a.compile.apply(this,[b]);a.log.debug("Twig.prepare: ","Compiled ",b);return b};a.Templates={registry:{}};a.validateId=function(b){if(b==="prototype")throw new a.Error(b+" is not a valid twig identifier");else if(a.Templates.registry.hasOwnProperty(b))throw new a.Error("There is already a template with the ID "+
b);return true};a.Templates.save=function(b){if(b.id===void 0)throw new a.Error("Unable to save template with no id");a.Templates.registry[b.id]=b};a.Templates.load=function(b){return!a.Templates.registry.hasOwnProperty(b)?null:a.Templates.registry[b]};a.Templates.loadRemote=function(b,c,e){var h=c.id,g=c.method,i=c.async,j=c.blocks,l=c.precompiled,k=null;i===void 0&&(i=true);h===void 0&&(h=b);if(a.Templates.registry.hasOwnProperty(h))return a.Templates.registry.hasOwnProperty(h);if(g=="ajax"){if(typeof XMLHttpRequest==
"undefined")throw Error("Unsupported platform: Unable to do remote requests because there is no XMLHTTPRequest implementation");var m=new XMLHttpRequest;m.onreadystatechange=function(){var c=null;m.readyState==4&&(a.log.debug("Got template ",m.responseText),c=l===true?JSON.parse(m.responseText):m.responseText,k=new a.Template({data:c,blocks:j,id:h,url:b}),e&&e(k))};m.open("GET",b,i);m.send()}else(function(){var c=require("fs"),f=null;i===true?(console.log("Loading async from ",b),c.readFile(b,"utf8",
function(c,f){l===true&&(f=JSON.parse(f));k=new a.Template({data:f,blocks:j,id:h,path:b});e&&e(k)})):(console.log("Loading sync from ",b),f=c.readFileSync(b,"utf8"),l===true&&(f=JSON.parse(f)),k=new a.Template({data:f,blocks:j,id:h,path:b}),e&&e(k))})();if(i===false)return k};a.Template=function(d){var f=d.data,e=d.id,h=d.blocks,g=d.path,i=d.url;this.id=e;this.blocks=h||{};this.extend=null;this.path=g;this.url=i;this.tokens=c("String",f)?a.prepare.apply(this,[f]):f;this.render=function(c,d){var f=
this,e,g=d&&d.output=="blocks";this.importBlocks=function(d,e){var g=b(f,d),h=a.Templates.loadRemote(g,{method:f.url?"ajax":"fs",async:false,id:g}),e=e||false;h.render(c);Object.keys(h.blocks).forEach(function(b){if(e||f.blocks[b]===void 0)f.blocks[b]=h.blocks[b]})};e=a.parse.apply(this,[this.tokens,c]);return this.extend?(i=b(this,this.extend),this.parent=a.Templates.loadRemote(i,{method:this.url?"ajax":"fs",async:false,id:i,blocks:this.blocks}),this.parent.blocks=this.blocks,this.parent.render(c)):
g===true?this.blocks:e};e!==void 0&&a.Templates.save(this)};return a}(Twig||{});
(function(){if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===null)throw new TypeError;var c=Object(this),b=c.length>>>0;if(b===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Infinity&&d!==-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=b)return-1;for(d=d>=0?d:Math.max(b-Math.abs(d),0);d<b;d++)if(d in c&&c[d]===a)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){var b,d;if(this==
null)throw new TypeError(" this is null or not defined");var f=Object(this),e=f.length>>>0;if({}.toString.call(a)!="[object Function]")throw new TypeError(a+" is not a function");c&&(b=c);for(d=0;d<e;){var h;d in f&&(h=f[d],a.call(b,h,d,f));d++}};if(!Object.keys)Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var c=[],b;for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c};(function(){function a(b){var a=new Date(b.getFullYear()+
1,0,4);return(a-b)/864E5<7&&(b.getDay()+6)%7<(a.getDay()+6)%7?a.getFullYear():b.getMonth()>0||b.getDate()>=4?b.getFullYear():b.getFullYear()-((b.getDay()+6)%7-b.getDate()>2?1:0)}var c="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),b="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),d="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),f="January,February,March,April,May,June,July,August,September,October,November,December".split(",");Date.prototype.format=function(e){if(typeof e!==
"string"||/^\s*$/.test(e))return this+"";var h=new Date(this.getFullYear(),0,1),g=this;return e.replace(/[dDjlNSwzWFmMntLoYyaABgGhHisu]/g,function(e){switch(e){case "d":return("0"+g.getDate()).replace(/^.+(..)$/,"$1");case "D":return c[g.getDay()];case "j":return g.getDate();case "l":return b[g.getDay()];case "N":return(g.getDay()+6)%7+1;case "S":return e=g.getDate(),(e=Math.abs(e)%100)%10==1&&e!=11?"st":e%10==2&&e!=12?"nd":e%10==3&&e!=13?"rd":"th";case "w":return g.getDay();case "z":return Math.ceil((h-
g)/864E5);case "W":return e=new Date(a(g),0,4),e.setDate(e.getDate()-(e.getDay()+6)%7),("0"+(parseInt((g-e)/6048E5)+1)).replace(/^.(..)$/,"$1");case "F":return f[g.getMonth()];case "m":return("0"+(g.getMonth()+1)).replace(/^.+(..)$/,"$1");case "M":return d[g.getMonth()];case "n":return g.getMonth()+1;case "t":return(new Date(g.getFullYear(),g.getMonth()+1,-1)).getDate();case "L":return(new Date(g.getFullYear(),1,29)).getDate()==29?1:0;case "o":return a(g);case "Y":return g.getFullYear();case "y":return(g.getFullYear()+
"").replace(/^.+(..)$/,"$1");case "a":return g.getHours()<12?"am":"pm";case "A":return g.getHours()<12?"AM":"PM";case "B":return Math.floor(((g.getUTCHours()+1)%24+g.getUTCMinutes()/60+g.getUTCSeconds()/3600)*1E3/24);case "g":return g.getHours()%12!=0?g.getHours()%12:12;case "G":return g.getHours();case "h":return("0"+(g.getHours()%12!=0?g.getHours()%12:12)).replace(/^.+(..)$/,"$1");case "H":return("0"+g.getHours()).replace(/^.+(..)$/,"$1");case "i":return("0"+g.getMinutes()).replace(/^.+(..)$/,"$1");
case "s":return("0"+g.getSeconds()).replace(/^.+(..)$/,"$1");case "u":return g.getMilliseconds()}})}})()})();
Twig=function(a){a.logic={};a.logic.type={if_:"Twig.logic.type.if",endif:"Twig.logic.type.endif",for_:"Twig.logic.type.for",endfor:"Twig.logic.type.endfor",else_:"Twig.logic.type.else",elseif:"Twig.logic.type.elseif",set:"Twig.logic.type.set",filter:"Twig.logic.type.filter",endfilter:"Twig.logic.type.endfilter",block:"Twig.logic.type.block",endblock:"Twig.logic.type.endblock",extends_:"Twig.logic.type.extends",use:"Twig.logic.type.use"};a.logic.definitions=[{type:a.logic.type.if_,regex:/^if\s+([^\s].+)$/,
next:[a.logic.type.else_,a.logic.type.elseif,a.logic.type.endif],open:true,compile:function(c){c.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c.match[1]}]).stack;delete c.match;return c},parse:function(c,b,d){var f="",e=a.expression.parse.apply(this,[c.stack,b]),d=true;e===true&&(d=false,f=a.parse.apply(this,[c.output,b]));return{chain:d,output:f}}},{type:a.logic.type.elseif,regex:/^elseif\s+([^\s].*)$/,next:[a.logic.type.else_,a.logic.type.endif],open:false,compile:function(c){c.stack=
a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c.match[1]}]).stack;delete c.match;return c},parse:function(c,b,d){var f="";d&&a.expression.parse.apply(this,[c.stack,b])===true&&(d=false,f=a.parse.apply(this,[c.output,b]));return{chain:d,output:f}}},{type:a.logic.type.else_,regex:/^else$/,next:[a.logic.type.endif,a.logic.type.endfor],open:false,parse:function(c,b,d){var f="";d&&(f=a.parse.apply(this,[c.output,b]));return{chain:d,output:f}}},{type:a.logic.type.endif,regex:/^endif$/,
next:[],open:false},{type:a.logic.type.for_,regex:/^for\s+([a-zA-Z0-9_,\s]+)\s+in\s+([^\s].+)$/,next:[a.logic.type.else_,a.logic.type.endfor],open:true,compile:function(c){var b=c.match[1],d=c.match[2],f=null,f=null;c.key_var=null;c.value_var=null;if(b.indexOf(",")>=0)if(f=b.split(","),f.length===2)c.key_var=f[0].trim(),c.value_var=f[1].trim();else throw new a.Error("Invalid expression in for loop: "+b);else c.value_var=b;f=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:d}]).stack;
c.expression=f;delete c.match;return c},parse:function(c,b,d){var f=a.expression.parse.apply(this,[c.expression,b]),e=[],h;f instanceof Array?(h=0,f.forEach(function(d){b[c.value_var]=d;c.key_var&&(b[c.key_var]=h);e.push(a.parse.apply(this,[c.output,b]));h+=1})):f instanceof Object&&(d=f._keys!==void 0?f._keys:Object.keys(f),d.forEach(function(d){d!=="_keys"&&f.hasOwnProperty(d)&&(b[c.value_var]=f[d],c.key_var&&(b[c.key_var]=d),e.push(a.parse.apply(this,[c.output,b])))}));d=e.length===0;return{chain:d,
output:e.join("")}}},{type:a.logic.type.endfor,regex:/^endfor$/,next:[],open:false},{type:a.logic.type.set,regex:/^set\s+([a-zA-Z0-9_,\s]+)\s*=\s*(.+)$/,next:[],open:true,compile:function(c){var b=c.match[1].trim(),d=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:c.match[2]}]).stack;c.key=b;c.expression=d;delete c.match;return c},parse:function(c,b,d){var f=a.expression.parse.apply(this,[c.expression,b]);b[c.key]=f;return{chain:d,context:b}}},{type:a.logic.type.filter,regex:/^filter\s+(.+)$/,
next:[a.logic.type.endfilter],open:true,compile:function(c){var b="|"+c.match[1].trim();c.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b}]).stack;delete c.match;return c},parse:function(c,b,d){var f=a.parse.apply(this,[c.output,b]),c=[{type:a.expression.type.string,value:f}].concat(c.stack),b=a.expression.parse.apply(this,[c,b]);return{chain:d,output:b}}},{type:a.logic.type.endfilter,regex:/^endfilter$/,next:[],open:false},{type:a.logic.type.block,regex:/^block\s+([a-zA-Z0-9_]+)$/,
next:[a.logic.type.endblock],open:true,compile:function(a){a.block=a.match[1].trim();delete a.match;return a},parse:function(c,b,d){var f="",e="";this.blocks[c.block]===void 0&&(f=a.expression.parse.apply(this,[{type:a.expression.type.string,value:a.parse.apply(this,[c.output,b])},b]),this.blocks[c.block]=f);this.extend===null&&(e=this.blocks[c.block]);return{chain:d,output:e}}},{type:a.logic.type.endblock,regex:/^endblock$/,next:[],open:false},{type:a.logic.type.extends_,regex:/^extends\s+(.+)$/,
next:[],open:true,compile:function(c){var b=c.match[1].trim();delete c.match;c.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b}]).stack;return c},parse:function(c,b,d){this.extend=a.expression.parse.apply(this,[c.stack,b]);return{chain:d,output:""}}},{type:a.logic.type.use,regex:/^use\s+(.+)$/,next:[],open:true,compile:function(c){var b=c.match[1].trim();delete c.match;c.stack=a.expression.compile.apply(this,[{type:a.expression.type.expression,value:b}]).stack;return c},
parse:function(c,b,d){this.importBlocks(a.expression.parse.apply(this,[c.stack,b]));return{chain:d,output:""}}}];a.logic.handler={};a.logic.extendType=function(c,b){a.logic.type[c]=b||"Twig.logic.type"+c};for(a.logic.extend=function(c){if(!c.type)throw new a.Error("Unable to extend logic definition. No type provided for "+c);if(a.logic.type[c.type])throw new a.Error("Unable to extend logic definitions. Type "+c.type+" is already defined.");else a.logic.extendType(c.type);a.logic.handler[c.type]=c};a.logic.definitions.length>
0;)a.logic.extend(a.logic.definitions.shift());a.logic.compile=function(c){var c=c.value.trim(),c=a.logic.tokenize.apply(this,[c]),b=a.logic.handler[c.type];b.compile&&(c=b.compile.apply(this,[c]),a.log.trace("Twig.logic.compile: ","Compiled logic token to ",c));return c};a.logic.tokenize=function(c){var b={},d=null,f=null,e=null,h=null,e=e=null,c=c.trim();for(d in a.logic.handler)if(a.logic.handler.hasOwnProperty(d)){f=a.logic.handler[d].type;e=a.logic.handler[d].regex;h=[];for(e instanceof Array?
h=e:h.push(e);h.length>0;)if(e=h.shift(),e=e.exec(c.trim()),e!==null)return b.type=f,b.match=e,a.log.trace("Twig.logic.tokenize: ","Matched a ",f," regular expression of ",e),b}throw new a.Error("Unable to parse '"+c.trim()+"'");};a.logic.parse=function(c,b,d){var f="",e,b=b||{};a.log.debug("Twig.logic.parse: ","Parsing logic token ",c);e=a.logic.handler[c.type];e.parse&&(f=e.parse.apply(this,[c,b,d]));return f};return a}(Twig||{});
Twig=function(a){a.expression={};a.expression.type={comma:"Twig.expression.type.comma",expression:"Twig.expression.type.expression",operator:"Twig.expression.type.operator",string:"Twig.expression.type.string",array:{start:"Twig.expression.type.array.start",end:"Twig.expression.type.array.end"},object:{start:"Twig.expression.type.object.start",end:"Twig.expression.type.object.end"},parameter:{start:"Twig.expression.type.parameter.start",end:"Twig.expression.type.parameter.end"},key:{period:"Twig.expression.type.key.period",
brackets:"Twig.expression.type.key.brackets"},filter:"Twig.expression.type.filter",variable:"Twig.expression.type.variable",number:"Twig.expression.type.number",setkey:"Twig.expression.type.setkey",test:"Twig.expression.type.test"};a.expression.set={operations:[a.expression.type.filter,a.expression.type.operator,a.expression.type.array.end,a.expression.type.object.end,a.expression.type.parameter.end,a.expression.type.comma,a.expression.type.setkey,a.expression.type.test],expressions:[a.expression.type.expression,
a.expression.type.string,a.expression.type.variable,a.expression.type.number,a.expression.type.array.start,a.expression.type.object.start]};a.expression.fn={compile:{push:function(a,b,d){d.push(a)}},parse:{push:function(a,b){b.push(a)},push_value:function(a,b){b.push(a.value)}}};a.expression.definitions=[{type:a.expression.type.test,regex:/^is\s+(not)?\s*([a-zA-Z_][a-zA-Z0-9_]*)/,next:a.expression.set.operations.concat([a.expression.type.parameter.start]),compile:function(a,b,d){a.filter=a.match[2];
a.modifier=a.match[1];delete a.match;delete a.value;d.push(a)},parse:function(c,b,d){var f=b.pop(),d=c.params&&a.expression.parse.apply(this,[c.params,d]),f=a.test(c.filter,f,d);c.modifier=="not"?b.push(!f):b.push(f)}},{type:a.expression.type.setkey,regex:/^\:/,next:a.expression.set.expressions,compile:function(c,b,d){b=d.pop();if(b.type!==a.expression.type.string)throw new a.Error("Unexpected object key: "+b);c.key=b.value;d.push(c)},parse:a.expression.fn.parse.push},{type:a.expression.type.comma,
regex:/^,/,next:a.expression.set.expressions,compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a)}},{type:a.expression.type.expression,regex:/^\(([^\)]+)\)/,next:a.expression.set.operations,compile:function(c,b,d){c.value=c.match[1];for(c=a.expression.compile(c).stack;c.length>0;)d.push(c.shift())}},{type:a.expression.type.operator,regex:/(^[\+\*\/\-\^~%]|^[<>!]=?|^==|^\|\||^&&)/,next:a.expression.set.expressions,compile:function(c,b,d){c=a.expression.operator.lookup(c.value,c);for(a.log.trace("Twig.expression.compile: ",
"Operator: ",c);b.length>0&&(c.associativity===a.expression.operator.leftToRight&&c.precidence>=b[b.length-1].precidence||c.associativity===a.expression.operator.rightToLeft&&c.precidence>b[b.length-1].precidence);)d.push(b.pop());b.push(c)},parse:function(c,b){a.expression.operator.parse(c.value,b)}},{type:a.expression.type.string,regex:/^(["'])(?:(?=(\\?))\2.)*?\1/,next:a.expression.set.operations,compile:function(c,b,d){b=c.value;b=b.substring(0,1)==='"'?b.replace('\\"','"'):b.replace("\\'","'");
c.value=b.substring(1,b.length-1);a.log.trace("Twig.expression.compile: ","String value: ",c.value);d.push(c)},parse:a.expression.fn.parse.push_value},{type:a.expression.type.parameter.start,regex:/^\(/,next:a.expression.set.expressions.concat([a.expression.type.parameter.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.parameter.end,regex:/^\)/,next:a.expression.set.operations,compile:function(c,b,d){for(;b.length>0;)d.push(b.pop());for(b=[];c.type!==
a.expression.type.parameter.start;)b.unshift(c),c=d.pop();b.unshift(c);c=d.pop();if(c.type!==a.expression.type.filter&&c.type!==a.expression.type.test)throw new a.Error("Expected filter before parameters, got "+c.type);c.params=b;d.push(c)},parse:function(c,b){for(var d=[],f=false,e=null;b.length>0;){e=b.pop();if(e.type&&e.type==a.expression.type.parameter.start){f=true;break}d.unshift(e)}if(!f)throw new a.Error("Expected end of parameter set.");b.push(d)}},{type:a.expression.type.array.start,regex:/^\[/,
next:a.expression.set.expressions.concat([a.expression.type.array.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.array.end,regex:/^\]/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a)},parse:function(c,b){for(var d=[],f=false,e=null;b.length>0;){e=b.pop();if(e.type&&e.type==a.expression.type.array.start){f=true;break}d.unshift(e)}if(!f)throw new a.Error("Expected end of array.");
b.push(d)}},{type:a.expression.type.object.start,regex:/^\{/,next:a.expression.set.expressions.concat([a.expression.type.object.end]),compile:a.expression.fn.compile.push,parse:a.expression.fn.parse.push},{type:a.expression.type.object.end,regex:/^\}/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,b,d){for(;b.length>0;)d.push(b.pop());d.push(a)},parse:function(c,b){for(var d={},f=false,e=null,h=null;b.length>0;){e=b.pop();
if(e.type&&e.type===a.expression.type.object.start){f=true;break}if(e.type&&e.type===a.expression.type.setkey){if(h===null)throw new a.Error("Expected value for key "+e.key+" in object definition. Got "+e);d[e.key]=h;if(d._keys===void 0)d._keys=[];d._keys.unshift(e.key);h=null}else h=e}if(!f)throw new a.Error("Unexpected end of object.");b.push(d)}},{type:a.expression.type.filter,regex:/^\|[a-zA-Z_][a-zA-Z0-9_\-]*/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets,
a.expression.type.parameter.start]),compile:function(a,b,d){a.value=a.value.substr(1);d.push(a)},parse:function(c,b,d){var f=b.pop(),d=c.params&&a.expression.parse.apply(this,[c.params,d]);b.push(a.filter(c.value,f,d))}},{type:a.expression.type.variable,regex:/^[a-zA-Z_][a-zA-Z0-9_]*/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:a.expression.fn.compile.push,parse:function(c,b,d){c=a.expression.resolve(c.value,d);b.push(c)}},{type:a.expression.type.key.period,
regex:/^\.([a-zA-Z_][a-zA-Z0-9_]*)/,next:a.expression.set.operations.concat([a.expression.type.key.period,a.expression.type.key.brackets]),compile:function(a,b,d){a.key=a.match[1];delete a.match;delete a.value;d.push(a)},parse:function(c,b){var d=c.key,f=b.pop();if(f===null||f===void 0)throw new a.Error("Can't access a key "+d+" on an undefined object.");b.push(f[d])}},{type:a.expression.type.key.brackets,regex:/^\[([^\]]*)\]/,next:a.expression.set.operations.concat([a.expression.type.key.period,
a.expression.type.key.brackets]),compile:function(c,b,d){b=c.match[1];delete c.value;delete c.match;c.stack=a.expression.compile({value:b}).stack;d.push(c)},parse:function(c,b,d){c=a.expression.parse.apply(this,[c.stack,d]);d=b.pop();if(!d.hasOwnProperty(c))throw new a.Error("Model doesn't provide the key "+c);b.push(d[c])}},{type:a.expression.type.number,regex:/^\-?\d+(\.\d+)?/,next:a.expression.set.operations,compile:function(a,b,d){a.value=Number(a.value);d.push(a)},parse:a.expression.fn.parse.push_value}];
a.expression.resolve=function(a,b){var d=b[a];return typeof d=="function"?d.apply(b,[b]):d};a.expression.handler={};a.expression.extendType=function(c){a.expression.type[c]="Twig.expression.type."+c};for(a.expression.extend=function(c){if(!c.type)throw new a.Error("Unable to extend logic definition. No type provided for "+c);a.expression.handler[c.type]=c};a.expression.definitions.length>0;)a.expression.extend(a.expression.definitions.shift());a.expression.tokenize=function(c){var b=[],d=0,f=null,
e,h,g,i,j,l=[],k;k=function(){var c=Array.prototype.slice.apply(arguments);c.pop();c.pop();a.log.trace("Twig.expression.tokenize","Matched a ",e," regular expression of ",c);if(f&&f.indexOf(e)<0)return l.push(e+" cannot follow a "+b[b.length-1].type+" at template:"+d+" near '"+c[0].substring(0,20)+"...'"),c[0];l=[];b.push({type:e,value:c[0],match:c});j=true;f=i;d+=c[0].length;return""};for(a.log.debug("Twig.expression.tokenize","Tokenizing expression ",c);c.length>0;){c=c.trim();for(e in a.expression.handler)if(a.expression.handler.hasOwnProperty(e)){i=
a.expression.handler[e].next;h=a.expression.handler[e].regex;a.log.trace("Checking type ",e," on ",c);g=h instanceof Array?h:[h];for(j=false;g.length>0;)h=g.pop(),c=c.replace(h,k);if(j)break}if(!j)if(l.length>0)throw new a.Error(l.join(" OR "));else throw new a.Error("Unable to parse '"+c+"' at template position"+d);}a.log.trace("Twig.expression.tokenize","Tokenized to ",b);return b};a.expression.compile=function(c){var b=c.value,d=a.expression.tokenize(b),f=null,e=[],h=[],g=null;a.log.trace("Twig.expression.compile: ",
"Compiling ",b);for(a.log.trace("Twig.expression.compile: ","Tokens tokenized to ",d);d.length>0;)f=d.shift(),g=a.expression.handler[f.type],g.compile&&g.compile(f,h,e);for(;h.length>0;)e.push(h.pop());a.log.trace("Twig.expression.compile: ","Stack is",e);c.stack=e;delete c.value;return c};a.expression.parse=function(c,b){var d=this;c instanceof Array||(c=[c]);var f=[],e=null;c.forEach(function(c){e=a.expression.handler[c.type];e.parse&&e.parse.apply(d,[c,f,b])});return f.pop()};return a}(Twig||{});
Twig=function(a){a.expression.operator={leftToRight:"leftToRight",rightToLeft:"rightToLeft"};a.expression.operator.lookup=function(c,b){switch(c){case ",":b.precidence=18;b.associativity=a.expression.operator.leftToRight;break;case "?":case ":":b.precidence=16;b.associativity=a.expression.operator.rightToLeft;break;case "||":b.precidence=14;b.associativity=a.expression.operator.leftToRight;break;case "&&":b.precidence=13;b.associativity=a.expression.operator.leftToRight;break;case "==":case "!=":b.precidence=
9;b.associativity=a.expression.operator.leftToRight;break;case "<":case "<=":case ">":case ">=":b.precidence=8;b.associativity=a.expression.operator.leftToRight;break;case "~":case "+":case "-":b.precidence=6;b.associativity=a.expression.operator.leftToRight;break;case "*":case "/":case "%":b.precidence=5;b.associativity=a.expression.operator.leftToRight;break;case "!":b.precidence=3;b.associativity=a.expression.operator.rightToLeft;break;default:throw new a.Error(c+" is an unknown operator.");}b.operator=
c;return b};a.expression.operator.parse=function(c,b){a.log.trace("Twig.expression.operator.parse: ","Handling ",c);var d,f;switch(c){case "+":f=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d+f);break;case "-":f=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d-f);break;case "*":f=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d*f);break;case "/":f=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d/f);break;case "%":f=parseFloat(b.pop());d=parseFloat(b.pop());b.push(d%f);break;case "~":f=b.pop().toString();
d=b.pop().toString();b.push(d+f);break;case "!":b.push(!b.pop());break;case "<":f=b.pop();d=b.pop();b.push(d<f);break;case "<=":f=b.pop();d=b.pop();b.push(d<=f);break;case ">":f=b.pop();d=b.pop();b.push(d>f);break;case ">=":f=b.pop();d=b.pop();b.push(d>=f);break;case "==":f=b.pop();d=b.pop();b.push(d==f);break;case "!=":f=b.pop();d=b.pop();b.push(d!=f);break;case "||":f=b.pop();d=b.pop();b.push(d||f);break;case "&&":f=b.pop(),d=b.pop(),b.push(d&&f)}};return a}(Twig||{});
Twig=function(a){function c(a,c){var f=Object.prototype.toString.call(c).slice(8,-1);return c!==void 0&&c!==null&&f===a}a.filters={upper:function(a){return a.toUpperCase()},lower:function(a){return a.toLowerCase()},capitalize:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},title:function(a){return a.replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})},length:function(a){if(a instanceof Array||typeof a==="string")return a.length;else if(a instanceof Object)return a._keys===
void 0?Object.keys(a).length:a._keys.length},reverse:function(a){if(c("Array",a))return a.reverse();else if(c("String",a))return a.split("").reverse().join("");else{var d=a._keys||Object.keys(a).reverse();a._keys=d;return a}},sort:function(a){if(c("Array",a))return a.sort();else if(a instanceof Object){delete a._keys;var d=Object.keys(a).sort(function(c,d){return a[c]>a[d]});a._keys=d;return a}},keys:function(a){var c=[];(a._keys||Object.keys(a)).forEach(function(f){f!=="_keys"&&a.hasOwnProperty(f)&&
c.push(f)});return c},url_encode:function(a){return encodeURIComponent(a)},join:function(a,c){var f="",e=[],h=null;c&&c[0]&&(f=c[0]);a instanceof Array?e=a:(h=a._keys||Object.keys(a),h.forEach(function(c){c!=="_keys"&&a.hasOwnProperty(c)&&e.push(a[c])}));return e.join(f)},"default":function(b,c){if(c===void 0||c.length!==1)throw new a.Error("default filter expects one argument");return b===void 0||b===null||b===""?c[0]:b},json_encode:function(a){delete a._keys;return JSON.stringify(a)},merge:function(b,
c){var f=[],e=0,h=[];b instanceof Array?c.forEach(function(a){a instanceof Array||(f={})}):f={};if(!(f instanceof Array))f._keys=[];b instanceof Array?b.forEach(function(a){f._keys&&f._keys.unshift(e);f[e]=a;e++}):(h=b._keys||Object.keys(b),h.forEach(function(a){f[a]=b[a];f._keys.push(a);a=parseInt(a,10);!isNaN(a)&&a>=e&&(e=a+1)}));c.forEach(function(a){a instanceof Array?a.forEach(function(a){f._keys&&f._keys.push(e);f[e]=a;e++}):(h=a._keys||Object.keys(a),h.forEach(function(b){f[b]||f._keys.unshift(b);
f[b]=a[b];b=parseInt(b,10);!isNaN(b)&&b>=e&&(e=b+1)}))});if(c.length===0)throw new a.Error("Filter merge expects at least one parameter");return f},date:function(a,c){return(new Date(a)).format(c[0])}};a.filter=function(b,c,f){if(!a.filters[b])throw"Unable to find filter "+b;return a.filters[b](c,f)};a.filter.extend=function(b,c){a.filters[b]=c};return a}(Twig||{});
Twig=function(a){a.tests={empty:function(a){if(a===null||a===void 0)return true;if(a.length&&a.length>0)return false;for(var b in a)if(a.hasOwnProperty(b))return false;return true},odd:function(a){return a%2===1},even:function(a){return a%2===0},divisibleby:function(a,b){return a%b[0]===0},defined:function(a){return a!==void 0},none:function(a){return a===null}};a.test=function(c,b,d){if(!a.tests[c])throw"Test "+c+" is not defined.";return a.tests[c](b,d)};a.test.extend=function(c,b){a.tests[c]=b};
return a}(Twig||{});
Twig=function(a){a.exports={};a.exports.twig=function(c){var b=c.id;b&&a.validateId(b);if(c.debug!==void 0)a.debug=c.debug;if(c.data!==void 0)return new a.Template({data:c.data,id:b});else if(c.ref!==void 0){if(c.id!==void 0)throw Error("Both ref and id cannot be set on a twig.js template.");return a.Templates.load(c.ref)}else if(c.href!==void 0)return a.Templates.loadRemote(c.href,{id:b,precompiled:c.precompiled,method:"ajax",async:c.async},c.load);else if(c.path!==void 0)return a.Templates.loadRemote(c.path,{id:b,
precompiled:c.precompiled,method:"fs",async:c.async},c.load)};a.exports.extendFilter=function(c,b){a.filter.extend(c,b)};a.exports.extendTest=function(c,b){a.test.extend(c,b)};a.exports.extendTag=function(c){a.logic.extend(c)};a.exports.compile=function(c,b){var d;d=new a.Template({data:c,path:b.filename,id:b.filename});return function(a){return d.render(a)}};return a}(Twig||{});
typeof module!=="undefined"&&module.declare?module.declare([],function(a,c){for(key in Twig.exports)Twig.exports.hasOwnProperty(key)&&(c[key]=Twig.exports[key])}):typeof module!=="undefined"&&module.exports?module.exports=Twig.exports:(window.twig=Twig.exports.twig,window.Twig=Twig);
